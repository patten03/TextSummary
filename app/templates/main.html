<!DOCTYPE html>
<meta charset="UTF-8">
<html>
  <head>
    <style>
      /* Center page */
      body,
      html {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      html{
        background: repeating-linear-gradient(
        45deg, 
        black,
        black 5%,
        transparent 5%,
        transparent 7%,
        black 7%,
        black 12%,
        transparent 12%,
        transparent 14%,
        black 14%,
        black 19%,
        transparent 19%,
        transparent 100%
        );
      }

      /* Box container */
      .box {
        width: 90vw;
        max-width: 1400px;
      }
      .bar {
          width: 100%;
          display: flex;
          align-items: center;         /* vertical centering */
          justify-content: space-between;
          padding: 10px;
          box-sizing: border-box;
          background: black;
          color: white;
          margin-bottom: 20px;
      }
      .title {
          font-size: xx-large;
      }
      .history_button {
          width: 10%;                  /* exactly 10% of bar width */
          min-width: 100px;
      }
      .history_button button {
          width: 100%;
          background: transparent;
          color: white;
          border: 1px solid white;
          font-size: large;
          cursor: pointer;
      }

      .container {
        display: flex;
        gap: 20px;
        height: 50vh;               /* you can change this or use min-height */
        margin-bottom: 20px;
      }

      .left-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .right-column {
        flex: 1;
      }

      textarea {
        width: 100%;
        padding: 12px;
        font-size: 14px;
        box-sizing: border-box;
        resize: none;               /* optional: disable manual resize */
      }

      .left-column textarea:nth-child(1) {
        flex: 1;              /* top gets 10% of the space */
      }

      .left-column textarea:nth-child(2) {
        flex: 9;              /* bottom gets the rest (90%) */
      }

      .right-column textarea {
        height: 100%;         /* takes full height of the container */
      }

      .generate {
        width: 100%;
        box-sizing: border-box;
      }

      .generate button {
        width: 100%;
        padding: 12px;
        background: black;
        color: white;
        font-size: large;
        border: none;
        cursor: pointer;
      }

    </style>
  </head>

  <body>
    <div class="box">
      <div class="bar">
        <div class="title">
          Суммаризатор текстов
        </div>
        <div class="history_button">
          <button onclick="window.location.href='/historyPage'">
            История
          </button>
        </div>
      </div>

      <form name="form" method="post">
        <div class="container">
          <!-- Left side: two textareas (equal height) -->
          <div class="left-column">
            <textarea name="instruction" placeholder="Инструкция (например, «Сделай краткую выжимку этого текста в 3 предложениях» или «Выдели 5 ключевых мыслей»)" required></textarea>
            <textarea name="text" placeholder="Исходный текст" required></textarea>
          </div>

          <!-- Right side: one textarea that uses 100% height -->
          <div class="right-column">
            <textarea name="result" readonly placeholder="Результат"></textarea>
          </div>
        </div>
        <div class="generate">
          <button name="generate" type="submit">Сгенерировать результат</button>
        </div>
      </form>
  </body>

  <script>
    // Обработка кнопки генерации
    const form = document.forms['form'];
    const resultTextarea = document.querySelector('textarea[name="result"]');
    const generate = form.querySelector('button[name="generate"]');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const payload = {
        instruction: formData.get('instruction')?.trim() || '',
        text: formData.get('text')?.trim() || ''
      };

      if (!payload.text) {
        resultTextarea.value = 'Ошибка: введите текст';
        return;
      }

      generate.disabled = true;
      generate.textContent = 'Генерируем...';
      resultTextarea.value = 'Генерация...';

      try {
        const response = await fetch('/summarize', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);
        }

        const data = await response.json();
        resultTextarea.value = data.result || data;

      } catch (err) {
        console.error(err);
        resultTextarea.value = `Ошибка: ${err.message}`;
      } finally {
        generate.disabled = false;
        generate.textContent = 'Сгенерировать результат';
      }
  });
  </script>
</html>
